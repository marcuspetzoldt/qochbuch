  <div class="row">
    <% 3.times do |i| %>
    <div class="span4">
      <%= render(partial: 'form_for_pic', locals: { nr: i+1, image_path: Recipe.image_name(@recipe, i+1) }) %>
    </div>
    <% end %>
  </div>
  <div class="row">
    <div class="span12">

      <%= render('shared/error_messages', individuum: @recipe) %>
      <% flash.each do |key, value| %>
        <div class="alert alert-<%= key %>" style="margin: 8px"><%= value %></div>
      <% end %>

      <div class="accordion" id="accordion2">
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseOne">
              Region<i class="icon icon-chevron-down pull-right"></i>
            </a>
          </div>
          <div id="collapseOne" class="accordion-body collapse">
            <div class="accordion-inner">
              <div style="float:left; width: calc(50% - 8px)">
                <div id="region_usable" class="muted" style="text-align: justify">
                  <div class="tag tag-success">&#10004;</div>
                  <%= render(partial: 'layouts/tag_cloud', locals: { cloud: @regions[:usable], name: 'region_usable' }) %>
                </div>
              </div>
              <div style="float:right; width: calc(50% - 8px)">
                <div id="region_used" class="muted" style="text-align: justify">
                  <div class="tag tag-error">&#10008;</div>
                  <%= render(partial: 'layouts/tag_cloud', locals: { cloud: @regions[:used], name: 'region_used' }) %>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="accordion-group">
          <div class="accordion-heading">
            <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion2" href="#collapseTwo">
              Kategorie<i class="icon icon-chevron-down pull-right"></i>
            </a>
          </div>
          <div id="collapseTwo" class="accordion-body collapse">
            <div class="accordion-inner">
              <div style="float:left; width: calc(50% - 8px)">
                <div id="tag_usable" class="muted" style="text-align: justify">
                  <div class="tag tag-success">&#10004;</div>
                  <%= render(partial: 'layouts/tag_cloud', locals: { cloud: @tags[:usable], name: 'tag_usable' }) %>
                </div>
              </div>
              <div style="float:right; width: calc(50% - 8px)">
                <div id="tag_used" class="muted" style="text-align: justify">
                  <div class="tag tag-error">&#10008;</div>
                  <%= render(partial: 'layouts/tag_cloud', locals: { cloud: @tags[:used], name: 'tag_used' }) %>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <%= form_for(@recipe, html: { style: 'margin-bottom: 80px' }) do |f| %>
    <%= f.hidden_field(:regions, id: 'iregion_used', value: @recipe.tags.where(category: 0).map do |tag| tag.id end.join(' ') ) %>
    <%= f.hidden_field(:tags, id: 'itag_used', value: @recipe.tags.where(category: 1).map do |tag| tag.id end.join(' ') ) %>
  <div class="row">
    <div class="span5">
      <h4>Zutaten für <%= f.select(:portion, options_for_select(1..12, @recipe.portion), {include_blank: true}, class: 'inline') %> Portionen</h4>
      <div class="control-group">
        <div class="control-label">
          <span style="width:44px; padding-left: 4px; display: inline-block">Menge</span><span style="width: 80px; padding-left: 4px; display: inline-block">Maß</span>Zutat
        </div>
        <div class="controls">
          <div style="display: none"><input type="text" name="recipe[ingredients[amount]][]" pattern="([0-9]+,?[0-9]*|etwas)" style="width:40px; padding-left: 0" /><select name="recipe[ingredients[measure]][]" style="width: 80px; padding-left: 0"><%= options_for_select(Measure.all.map.each_with_index do |msr, idx| [msr.name, msr.id] end) %></select><input type="text" name="recipe[ingredients[tag]][]" style="width:214px; padding-left: 0" /><%= link_to('#', name: 'add_ingredient', style: 'margin-left: 4px; padding-left: 4px; padding-right: 4px; vertical-align: top', class: 'btn') do %><i class="icon icon-plus"></i><% end %></div>
          <%= render(partial: 'ingredient', collection: @ingredients, locals: { edit: true }) %>
          <div><input type="text" name="recipe[ingredients[amount]][]" pattern="([0-9]+,?[0-9]*|etwas)" style="width:40px; padding-left: 0" /><select name="recipe[ingredients[measure]][]" style="width: 80px; padding-left: 0"><%= options_for_select(Measure.all.map.each_with_index do |msr, idx| [msr.name, msr.id] end) %></select><input type="text" name="recipe[ingredients[tag]][]" style="width:214px; padding-left: 0" /><%= link_to('#', name: 'add_ingredient', style: 'margin-left: 4px; padding-left: 4px; padding-right: 4px; vertical-align: top', class: 'btn') do %><i class="icon icon-plus"></i><% end %></div>
        </div>
      </div>
    </div>
    <div class="span7">
      <h4>Zubereitung</h4>
      <div class="control-group">
        <%= f.label(:time, class: 'control-label') %>
        <div class="controls">
          <div class="input-append">
            <%= f.number_field(:time, min: '1', pattern: '[1-9][0-9]*', placeholder: :time) %>
            <span class="add-on">min</span>
          </div>
        </div>
      </div>
      <div class="control-group">
        <%= f.label(:level, class: 'control-label') %>
        <div class="controls">
          <%= f.select(:level, Recipe.levels.map.each_with_index do |lvl, idx| [lvl, idx] end) %>
        </div>
      </div>
      <div class="control-group">
        <%= f.label(:title, class: 'control-label') %>
        <div class="controls">
          <%= f.text_field(:title, class: 'input-block-level', maxlength: '60', placeholder: :title) %>
        </div>
      </div>
      <div class="control-group">
        <%= f.label(:description, class: 'control-label') %>
        <div class="controls">
          <%= f.text_field(:description, class: 'input-block-level', maxlength: '200', placeholder: :description) %>
        </div>
      </div>
      <div class="control-group">
        <%= f.label(:directions, class: 'control-label') %>
        <div class="controls">
          <%= f.cktext_area(:directions, class: 'span7', rows: '16', :ckeditor => {:language => "de"}) %>
        </div>
      </div>
      <div class="control-group">
        <div class="controls">
          <%= f.button('Speichern', class: 'btn btn-primary', name: 'commit', id: 'commit') %>&nbsp;
          <%= f.button('Abbrechen', class: 'btn', name: 'cancel', id: 'cancel') %>
        </div>
      </div>
    </div>
  </div>
<% end %>
<div id="busy" style="visibility: hidden">
  <div class="container">
    <div class="row">
      <div class="span6 offset3 img-rounded" style="position:fixed; top: 25%; border: 2px solid black; background-color: white; text-align: center; padding-bottom: 20px">
        <h4>Rezept wird gespeichert ...</h4>
        <%= image_tag('ajax-loader.gif') %>
      </div>
    </div>
  </div>
</div>
